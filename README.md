Simple JS Error Handler
======================
This library provides a simple way to take screenshots, retrieve stack traces, and send errors to your server via POST requests when reporting errors.

## Setup

Load simpleJsErrorHandler:
```
<script type="text/javascript" src="path/to/simpleJsErrorHandler.js"></script>
```

Configure simpleJsErrorHandler:

Call window.simpleJsErrorHandler.configure with a configuation object with the following properties.

submitErrorUrl: 				Optionally a url where you want to submit the error to a server.  
 								If you provide a submitErrorUrl and your guard specifies that the 
 								error should be submitted, then the error handler will submit a post 
 								request which can contain query string parameters message, url, 
 								lineNumber, columnNumber, stack, screenshot + other custom properties 
 								you add to an error object when using simpleJsErrorHandler.report().
 	
 submitErrorRequestHeaders: 	Extra request headers to send along with your error submissions.  These
                                headers are sometimes required to prevent cross site scripting attacks.  For
                                example, django requires you provide a X-CSRFToken.  (An example for django is
                                is shown below.)
 
 html2canvasUrl: 				Url to retrieve the html2canvas.js script if you want to take screenshots.
 								We load the html2canvas library before the first time you want to take a 
 								screenshot of the page when reporting an error.  Note, you can load
 								the html2canvas script however any other way if you want as long as the
 								window.html2canvas object exists.
 
 stacktraceUrl: 				Url to retrieve the stacktrace.js script if you want to retrieve stack traces
 								when reporting errors.  We load the stacktrace library before the first time 
 								you want to retrieve the stack trace when reporting an error.  Unfortunately,
 								there's a corner case for the first error reported.  We are not able to retrieve
 								a useful stacktrace for the first error hit that should retrieve a stack trace
 								because we would have to execute the code the retrieves the stack trace in a callback
 								which is called after the stacktrace.js script has loaded.  Retrieving a stack trace
 								that begins at the callback deeply embedded in the error handling code would produce 
 								a meaningless stack trace.  Alternatively, you can preload the stacktrace library
 								if you want to avoid this corner case.  The error handler will work correctly as long
 								as window.printStackTrace is exposed.
 
 setupWindowOnError: 			Whether or not you want to setup simpleJsErrorHandler to execute when window.onError
 								is called.  Alternatively, you can just manually call simpleJsErrorHandler.report to 
 								report errors.
 
 guard: 						Function which that takes in the current error object, an array of previously encountered errors, and whether or 
          						not the error was generated by calling simpleJsErrorHandler.report().  Given this information, the guard function returns
          						an object which specifies whether or not we should get a stack trace using stacktrace.js, take a screenshot using
          						html2canvas.js, and/or submit an error to the server.  The object returned should have the following structure:
          						{ retrieveStacktrace: false, takeScreenshot: false, submitError: false }.  Note, taking a screenshot can be 
          						particuraly computationally intensive.  If you do not specify a guard function, we'll use a default will try to 
          						retieve a stacktrace, take a screenshot and submit the error unless we've encountered more than 5 errors in the 
          						last second or if we've encountered more than 20 errors total.  We'll try to do none of the mentioned actions if 
          						any either of the two conditions is hit.


Example:

```
window.simpleJsErrorHandler.configure({ 
	submitErrorUrl: "http://www.yourdomain.com/path/to/submit",
	submitErrorRequestHeaders: [ { bstrHeader: "YourBSTRHeader", bstrValue: YourBSTRValue } ],
	html2canvasUrl: "http://www.yourdomain.com/path/to/html2canvas.js",
	stacktraceUrl: "http://www.yourdomain.com/path/to/stacktrace.js,
	setupWindowOnError: true,
    guard: function (errorObj, encounteredErrors, isReport) {
        return {
            retrieveStacktrace: true,
            takeScreenshot: true,
            submitError: true
		}
	}
});
```

Example with django and cross site scripting prevention:
```
function getCookie(name) {
	    var value = "; " + document.cookie,
	        parts = value.split("; " + name + "=");
	    if (parts.length === 2) {
	        return parts.pop().split(";").shift();
	    }
	}
var csrfCookie = getCookie("csrftoken");

window.simpleJsErrorHandler.configure({ 
	submitErrorUrl: "http://www.yourdomain.com/path/to/submit",
    submitErrorRequestHeaders: [ { bstrHeader: "X-CSRFToken", bstrValue: csrfCookie } ],
	html2canvasUrl: "http://www.yourdomain.com/path/to/html2canvas.js",
	stacktraceUrl: "http://www.yourdomain.com/path/to/stacktrace.js,
	setupWindowOnError: true
});
```

## Usage

Either allow simpleJsErrorHandler to do it's work when window.onerror is executed as errors are thrown or manually report errors with 
window.simpleJsErrorHandler.report.

```
window.simpleJsErrorHandler.report(new Error("Something went wrong"));
```

simpleJsErrorHandler logs all errors to the console and sends a post request to your specified submitErrorUrl.  The request issue looks
something like:

```
http://www.yourdomain.com/path/to/submit?url="http://www.yourdomain.com/path/to/page"&
                                         stack="stack trace" &
                                         screenshot="data:image/png;base64,iVBORw0KGgoAAAAN..." &
                                         message="error message" &
                                         columnNumber=67 &
                                         lineNumber=43 &
                                         otherPropertyOnYourReportedError="Whatever you want"
```
