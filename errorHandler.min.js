(function(){if(window.errorHandler){console.log("You have loaded errorHandler.js more than once!  Only load it once for performance gains..")}var d,o,q,b,n,i,t,m,r=[];function v(y){return y!=="undefined"&&y!==null}function c(z){var y=window.printStackTrace();z.stack=y.join("\n");return z}function l(y,z){window.html2canvas(document.body,{onrendered:function(A){try{y.screenshot=A.toDataURL("image/png");z(y)}catch(B){console.log("Error in error handler!");console.log(B);z(y)}}})}function p(A){var C=[],y=["stack"],z,B;for(B in A){if(A.hasOwnProperty(B)&&y.indexOf(B)===-1){C.push(encodeURIComponent(B)+"="+encodeURIComponent(A[B]))}}for(z=0;z<y.length;z+=1){B=y[z];if(v(B)){C.push(encodeURIComponent(B)+"="+encodeURIComponent(A[B]))}}return C.join("&")}function h(A){var y=new window.XMLHttpRequest(),z;if(!o){console.log(A)}y.open("POST",o,true);if(q){for(z=0;z<q.length;z+=1){y.setRequestHeader(q[z].bstrHeader,q[z].bstrValue)}}y.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8");y.send(p(A))}function k(y,A){var z=document.createElement("script");z.type="text/javascript";z.src=y;z.async=false;z.onreadystatechange=z.onload=function(){try{var B=z.readyState;if(!A.done&&(!B||/loaded|complete/.test(B))){A.done=true;A()}}catch(C){console.log("Error in error handler!");console.log(C)}};(document.body||document.head).appendChild(z)}function w(D,A,y,z,C){var B={};if(["number","string","boolean"].indexOf(typeof C)!==-1){D=C}else{B=C;D=C.message||D;A=B.url||A;y=B.lineNumber||y;z=B.columnNumber||z}if(v(D)){B.message=D}if(v(A)){B.url=A}if(v(y)){B.lineNumber=y}if(v(z)){B.columnNumber=z}return B}function e(y,z){return{retrieveStacktrace:!!(y.retrieveStacktrace&&n&&z),takeScreenshot:!!(y.takeScreenshot&&b&&y.submitError&&o),submitError:!!(y.submitError&&o)}}function u(B){var A,z=Date.now(),y=z-(B*1000);for(A=r.length-1;A>=0;A-=1){if(r[A].timestamp>y){break}}return A+1}function f(z){var B=5,A=1,y=u(A);if(y>B||r.length>20){return{retrieveStacktrace:false,takeScreenshot:false,submitError:false}}return{retrieveStacktrace:!!(z.stack),takeScreenshot:true,submitError:true}}function a(z,y){try{if(y.retrieveStacktrace&&!window.printStackTrace){k(n,function(){a(z,y)});return}if(y.takeScreenshot&&!window.html2canvas){k(b,function(){a(z,y)});return}if(y.retrieveStacktrace){z=c(z)}if(y.takeScreenshot){l(z,function(B){if(y.submitError){h(B)}console.log(B)})}else{if(y.submitError){h(z)}console.log(z)}}catch(A){console.log("Error in error handler!");console.log(A)}}function j(C,y,B,z,F,H){try{var G=w(C,y,B,z,F),A=d(G,r,H),E=e(A,H);r.push({timestamp:Date.now(),error:G});a(G,E)}catch(D){console.log("Error in error handler!");console.log(D)}}function g(){var y=window.onerror;window.onerror=function(D,B,z,A,C){if(typeof y==="function"){y(D,B,z,A,C)}if(i){j(D,B,z,A,C,false)}};m=true}function s(y){if(!t){throw new Error("Error handling not set up!  Please use window.errorHandler.configure to configure your error handler before you report errors.")}j(null,window.location.href,null,null,y,true)}function x(y){if(!y.submitErrorUrl){console.log("Please provide a error handler url if you want to send errors to your server.")}if(!y.html2canvasUrl){console.log("Please provide a url to html2canvas if your want to include a screenshot of the page when your report or handle thrown errors.")}if(!y.stacktraceUrl){console.log("Please provide a url to stacktrace.js if you want to include a stack trace when your report errors in all browsers.")}d=y.guard||f;o=y.submitErrorUrl;q=y.submitErrorRequestHeaders;b=y.html2canvasUrl;n=y.stacktraceUrl;i=y.setupWindowOnError;t=true;if(!m&&i){g()}}window.errorHandler={configure:x,report:s}}());
